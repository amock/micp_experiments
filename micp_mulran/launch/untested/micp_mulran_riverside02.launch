<?xml version="1.0" ?>

<launch>

<arg name="gui" default="false" />
<arg name="rate" default="1.0" />
<arg name="mulran_bag" default="/home/amock/datasets/mulran/bags/Riverside/Riverside02.bag" />
<arg name="mesh_file" default="/home/amock/datasets/mulran_meshes/lvr2/Riverside/riverside02_mesh_red05_cleaned.ply" />
<arg name="initial_guess" default="[-2.0, 2.0, 18.7, 0, 0.0, 0.67]" />


<node pkg="rosbag" type="play" name="rosbag" args="$(arg mulran_bag) -r $(arg rate)" output="screen" />

<!-- make tf static -->

<!-- TODO make proper URDF for static transforms -->
<node pkg="tf2_ros" type="static_transform_publisher" name="base_to_radar_static" args="1.5 -0.04 1.97 0 0 0.007853900888711334 0.9999691576447897 base_link radar_polar" />
<node pkg="tf2_ros" type="static_transform_publisher" name="base_to_ouster_static" args="1.7042 -0.021 1.8047 0 0 0 1 base_link ouster" />


<arg name="mesh_to_map_transform" default="[0, 0, 0, 0, 0, 0, 1]" />

# run registration
<node pkg="rmcl" type="micp_eval" name="micp_eval" output="screen">
    <param name="mesh_file" type="string" value="$(arg mesh_file)" />
    <rosparam param="mesh_to_map_transform" subst_value="True">$(arg mesh_to_map_transform)</rosparam>
    <rosparam param="initial_guess" subst_value="True">$(arg initial_guess)</rosparam>
    
    <param name="lidar_frame" value="ouster" />
    <param name="base_frame" value="base_link" />
    <param name="odom_frame" value="world" />
    <param name="map_frame" value="map" />

    <remap from="ouster/points" to="os1_points" />

    <param name="disable_registration" value="false" />
    <param name="generate_evaluation" value="false" />

    <param name="correction_mode" value="1" />
    <param name="iterations" value="20" />
</node>

<group if="$(arg gui)">
    <node pkg="rviz" type="rviz" name="rviz" args="-d $(find micp_mulran)/rviz/micp_mulran_riverside.rviz" output="screen"/>
</group>

</launch>
